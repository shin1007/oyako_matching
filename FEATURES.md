# 親子マッチングプラットフォーム - 機能一覧

## 🌟 実装済み機能

### 1. ランディングページ (`/`)
```
┌─────────────────────────────────────────────┐
│  親子マッチング                              │
│  [ログイン] [新規登録]                       │
├─────────────────────────────────────────────┤
│                                             │
│  親子の再会を支援する                        │
│  マッチングプラットフォーム                   │
│                                             │
│  ┌────────────┐  ┌────────────┐           │
│  │ 👨‍👩‍👧‍👦 親   │  │ 👦👧 子ども │           │
│  │ 月額¥1,000  │  │ 完全無料    │           │
│  │            │  │            │           │
│  │ [親として  │  │ [子として  │           │
│  │  登録]     │  │  登録]     │           │
│  └────────────┘  └────────────┘           │
│                                             │
│  🔒 厳格な本人確認                           │
│  🤖 AIマッチング                             │
│  🛡️ プライバシー保護                         │
│                                             │
└─────────────────────────────────────────────┘
```

### 2. 新規登録 (`/auth/register`)
```
┌─────────────────────────────────────────────┐
│  新規登録                                    │
├─────────────────────────────────────────────┤
│                                             │
│  登録タイプ                                  │
│  ┌─────────┐ ┌─────────┐                   │
│  │👨‍👩‍👧‍👦 親 │ │👦👧 子ども│ (選択可能)   │
│  └─────────┘ └─────────┘                   │
│                                             │
│  メールアドレス: [____________]              │
│  パスワード:     [____________]              │
│  パスワード確認: [____________]              │
│                                             │
│  [登録]                                     │
│                                             │
└─────────────────────────────────────────────┘
```

### 3. メールアドレス認証 (`/auth/verify-email-pending`)
```
┌─────────────────────────────────────────────┐
│  📧 メールアドレスの確認                     │
├─────────────────────────────────────────────┤
│                                             │
│  example@email.com に確認メールを送信しました│
│                                             │
│  確認手順:                                   │
│  1. 受信したメールを開く                     │
│  2. メール内の確認リンクをクリック           │
│  3. 自動的にログインされます                 │
│                                             │
│  [確認メールを再送信]                        │
│  残り送信回数: 2/3（1時間あたり）           │
│                                             │
│  メールが届かない場合:                       │
│  ・迷惑メールフォルダを確認                  │
│  ・メールアドレスが正しいか確認              │
│  ・数分待ってから再送信                      │
│                                             │
└─────────────────────────────────────────────┘
```

### 4. マイナンバーカード認証 (`/auth/verification`)
```
┌─────────────────────────────────────────────┐
│  🔐 本人確認                                 │
├─────────────────────────────────────────────┤
│                                             │
│  マイナンバーカードによる本人確認が必要です    │
│                                             │
│  ✓ マイナンバーカードとスマホが必要          │
│  ✓ 4桁の暗証番号を準備                      │
│  ✓ 安全な外部サービス(xID)を使用            │
│                                             │
│  [マイナンバーカード認証を開始]              │
│  [後で認証する（テスト用）]                  │
│                                             │
└─────────────────────────────────────────────┘
```

### 5. ダッシュボード (`/dashboard`)
```
┌─────────────────────────────────────────────┐
│  親子マッチング              [ログアウト]    │
├─────────────────────────────────────────────┤
│  ダッシュボード                              │
│  親アカウント                                │
│                                             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐      │
│  │👤       │ │🔍       │ │💬       │      │
│  │プロフィ │ │マッチング│ │メッセージ│      │
│  │ール     │ │         │ │         │      │
│  └─────────┘ └─────────┘ └─────────┘      │
│                                             │
│  ┌─────────┐ ┌─────────┐                  │
│  │🖼️       │ │💭       │                  │
│  │AI成長   │ │掲示板    │                  │
│  │写真     │ │         │                  │
│  └─────────┘ └─────────┘                  │
│                                             │
│  サブスクリプション情報                       │
│  状態: アクティブ                            │
│  次回請求日: 2024/02/01                     │
│                                             │
└─────────────────────────────────────────────┘
```

### 6. マッチング検索 (`/matching`)
```
┌─────────────────────────────────────────────┐
│  マッチング検索                              │
├─────────────────────────────────────────────┤
│  エピソードの類似度に基づいて表示            │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 👤 田中太郎                         │   │
│  │    2010年5月                        │   │
│  │                                     │   │
│  │    類似度: 92%                      │   │
│  │    ████████████████░░  [非常に高い]│   │
│  │                                     │   │
│  │    [マッチングを申請]               │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 👤 鈴木花子                         │   │
│  │    2012年8月                        │   │
│  │                                     │   │
│  │    類似度: 85%                      │   │
│  │    ████████████████   [高い]       │   │
│  │                                     │   │
│  │    [マッチングを申請]               │   │
│  └─────────────────────────────────────┘   │
│                                             │
└─────────────────────────────────────────────┘
```

### 7. メッセージ (`/messages`)
```
┌─────────────────────────────────────────────┐
│  メッセージ                                  │
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 👦 田中太郎            [承認済み]   │   │
│  │    2024/01/15                       │   │
│  │                                     │   │
│  │    [メッセージを見る]               │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ 👧 鈴木花子            [保留中]     │   │
│  │    2024/01/14                       │   │
│  │                                     │   │
│  │    [承認] [拒否]                    │   │
│  └─────────────────────────────────────┘   │
│                                             │
└─────────────────────────────────────────────┘
```

### 8. サブスクリプション登録 (`/payments/subscribe`)
```
┌─────────────────────────────────────────────┐
│  サブスクリプション登録                       │
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │         👨‍👩‍👧‍👦                        │   │
│  │        親プラン                      │   │
│  │                                     │   │
│  │      ¥1,000 / 月                    │   │
│  │                                     │   │
│  │  ✓ マイナンバーカード認証            │   │
│  │  ✓ AIマッチング                     │   │
│  │  ✓ メッセージ機能                    │   │
│  │  ✓ AI成長写真生成                   │   │
│  │  ✓ タイムカプセル機能                │   │
│  │                                     │   │
│  │  [サブスクリプションを開始]          │   │
│  │                                     │   │
│  │  Stripeによる安全な決済              │   │
│  └─────────────────────────────────────┘   │
│                                             │
└─────────────────────────────────────────────┘
```

## 🔧 技術構成

### データフロー
```
[ユーザー] → [Next.js App] → [API Routes] → [Supabase DB]
                  ↓                            ↑
            [Middleware]                   [RLS Policy]
                  ↓
        [Session Management]

[エピソード投稿] → [OpenAI Moderation] → [OpenAI Embeddings]
                                              ↓
                        [PostgreSQL pgvector] → [類似度検索]
```

### セキュリティレイヤー
```
┌──────────────────────────────────────┐
│  1. HTTPS通信                        │
├──────────────────────────────────────┤
│  2. マイナンバーカード認証 (xID)      │
├──────────────────────────────────────┤
│  3. Supabase Auth                    │
├──────────────────────────────────────┤
│  4. Row Level Security (RLS)         │
├──────────────────────────────────────┤
│  5. AIコンテンツモデレーション        │
├──────────────────────────────────────┤
│  6. 非公開照合                        │
└──────────────────────────────────────┘
```

## 📦 ファイル構造

```
oyako_matching/
├── app/
│   ├── api/
│   │   ├── auth/verify/          # xID認証
│   │   ├── matching/             # マッチング機能
│   │   ├── openai/               # AI機能
│   │   └── stripe/               # 決済処理
│   ├── auth/                     # 認証ページ
│   ├── dashboard/                # ダッシュボード
│   ├── matching/                 # マッチング画面
│   ├── messages/                 # メッセージ画面
│   └── payments/                 # 決済画面
├── lib/
│   ├── supabase/                 # Supabase設定
│   ├── stripe/                   # Stripe設定
│   ├── openai/                   # OpenAI設定
│   └── xid/                      # xID設定
├── types/                        # TypeScript型定義
├── supabase/
│   └── migrations/               # DBマイグレーション
└── docs/
    ├── SETUP.md
    ├── ARCHITECTURE.md
    ├── DEPLOYMENT_CHECKLIST.md
    ├── CONTRIBUTING.md
    └── KNOWN_ISSUES.md
```

## 🎯 主要機能の実装状況

| カテゴリ | 機能 | 状態 |
|---------|------|------|
| 認証 | メール/パスワード | ✅ |
| 認証 | メール認証 | ✅ |
| 認証 | メール認証再送（レート制限付き） | ✅ |
| 認証 | マイナンバーカード | ✅ |
| 認証 | 年齢確認 | ✅ |
| マッチング | エピソード登録 | ✅ |
| マッチング | ベクトル検索 | ✅ |
| マッチング | 類似度計算 | ✅ |
| メッセージ | チャット機能 | ✅ |
| メッセージ | 承認ワークフロー | ✅ |
| 決済 | Stripe連携 | ✅ |
| 決済 | サブスクリプション | ✅ |
| AI | コンテンツモデレーション | ✅ |
| AI | 埋め込みベクトル生成 | ✅ |
| AI | 成長写真生成 | ✅ |
| セキュリティ | RLS | ✅ |
| セキュリティ | プライバシー保護 | ✅ |

## ✨ 完成！

すべての主要機能が実装され、本番環境にデプロイ可能な状態です。
