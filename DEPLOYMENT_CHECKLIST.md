# デプロイチェックリスト

本番環境へのデプロイ前に確認すべき項目のチェックリストです。

## 環境設定

### Supabase
- [ ] プロジェクトが作成されている
- [ ] データベースマイグレーションが実行されている
- [ ] pgvector 拡張機能が有効化されている
- [ ] Row Level Security ポリシーが適用されている
- [ ] 本番用の API キーを使用している
- [ ] サービスロールキーが安全に管理されている

### Stripe
- [ ] 本番用アカウントを使用している（テストモードではない）
- [ ] サブスクリプション商品が作成されている（¥1,000/月）
- [ ] Price ID が環境変数に設定されている
- [ ] Webhook エンドポイントが設定されている
- [ ] Webhook 署名シークレットが設定されている
- [ ] 正しいイベントが監視されている:
  - [ ] customer.subscription.created
  - [ ] customer.subscription.updated
  - [ ] customer.subscription.deleted
  - [ ] invoice.payment_failed

### OpenAI
- [ ] 本番用 API キーを使用している
- [ ] 請求情報が設定されている
- [ ] 使用制限とアラートが設定されている
- [ ] モデルへのアクセスが確認されている:
  - [ ] text-embedding-3-small
  - [ ] gpt-4 または gpt-3.5-turbo
  - [ ] dall-e-3

### xID API
- [ ] 本番用 API キーとシークレットが設定されている
- [ ] コールバック URL が正しく設定されている
- [ ] 本番環境のドメインが登録されている

## セキュリティ

### 環境変数
- [ ] すべての機密情報が環境変数として設定されている
- [ ] `.env.local` がリポジトリにコミットされていない
- [ ] `.gitignore` に `.env*` が含まれている
- [ ] 本番環境の環境変数が Vercel/ホスティングサービスに設定されている

### HTTPS
- [ ] 本番環境で HTTPS が有効化されている
- [ ] SSL/TLS 証明書が有効である
- [ ] HTTP から HTTPS へのリダイレクトが設定されている

### CORS
- [ ] CORS ポリシーが適切に設定されている
- [ ] 許可されたオリジンのみがアクセス可能

### レート制限
- [ ] API エンドポイントにレート制限が設定されている（推奨）
- [ ] DDoS 対策が実装されている（Vercel/Cloudflare）

## コード品質

### ビルド
- [ ] `npm run build` がエラーなく完了する
- [ ] TypeScript のエラーがない
- [ ] ESLint の警告が解決されている

### テスト
- [ ] 主要な機能が動作確認されている:
  - [ ] ユーザー登録
  - [ ] ログイン
  - [ ] マイナンバーカード認証フロー
  - [ ] プロフィール作成・編集
  - [ ] エピソード作成
  - [ ] マッチング検索
  - [ ] メッセージ送信
  - [ ] サブスクリプション作成
  - [ ] Webhook 処理

### パフォーマンス
- [ ] ページロード時間が3秒以内
- [ ] 画像が最適化されている
- [ ] 不要な依存関係が削除されている

## データベース

### バックアップ
- [ ] 自動バックアップが有効化されている
- [ ] バックアップの復元手順が文書化されている

### インデックス
- [ ] 必要なインデックスがすべて作成されている
- [ ] ベクトル検索用の ivfflat インデックスが設定されている

### パフォーマンス
- [ ] スロークエリが特定され最適化されている
- [ ] 接続プーリングが設定されている

## 監視・ログ

### エラートラッキング
- [ ] エラートラッキングツールが設定されている（Sentry 等）
- [ ] 重要なエラーのアラートが設定されている

### アナリティクス
- [ ] アクセス解析が設定されている
- [ ] コンバージョントラッキングが設定されている

### ログ
- [ ] アプリケーションログが記録されている
- [ ] ログローテーションが設定されている
- [ ] 機密情報がログに記録されていない

## コンプライアンス

### 法的要件
- [ ] 利用規約が作成されている
- [ ] プライバシーポリシーが作成されている
- [ ] 特定商取引法に基づく表記がある
- [ ] ストーカー規制法への対応が実装されている

### データ保護
- [ ] 個人情報保護法への対応
- [ ] データの暗号化（保存時・転送時）
- [ ] データ削除機能の実装
- [ ] データアクセスログの記録

## ドキュメント

### ユーザー向け
- [ ] ヘルプページが作成されている
- [ ] FAQ が作成されている
- [ ] お問い合わせフォームが設置されている

### 開発者向け
- [ ] README が更新されている
- [ ] SETUP.md が完成している
- [ ] ARCHITECTURE.md が完成している
- [ ] API ドキュメントが作成されている

## インフラ

### ホスティング（Vercel）
- [ ] プロジェクトがインポートされている
- [ ] カスタムドメインが設定されている
- [ ] DNS レコードが正しく設定されている
- [ ] ビルド設定が正しい
- [ ] 環境変数がすべて設定されている

### CDN
- [ ] 静的アセットが CDN 経由で配信されている
- [ ] キャッシュ設定が適切である

### スケーリング
- [ ] オートスケーリングが設定されている
- [ ] 負荷テストが実施されている

## 緊急対応

### 連絡先
- [ ] 緊急連絡先リストが作成されている
- [ ] オンコール体制が整備されている

### ロールバック
- [ ] ロールバック手順が文書化されている
- [ ] 前バージョンへの切り戻しが可能

### メンテナンス
- [ ] メンテナンスページが準備されている
- [ ] メンテナンス通知の手順が確立されている

## ローンチ後

### 1日後
- [ ] エラーログを確認
- [ ] パフォーマンスメトリクスを確認
- [ ] ユーザーフィードバックを収集

### 1週間後
- [ ] ユーザー登録数を確認
- [ ] コンバージョン率を分析
- [ ] システムの安定性を評価

### 1ヶ月後
- [ ] 月次レポートを作成
- [ ] 改善点を特定
- [ ] 次の機能開発を計画

## 署名

- デプロイ実施者: __________________
- レビュー者: __________________
- 承認者: __________________
- 実施日時: __________________
