# コンテンツモデレーション セットアップガイド

## 概要
このプロジェクトでは、掲示板のコンテンツモデレーション（不適切な投稿の検出）に **bad-words ライブラリ + 日本語カスタム辞書** を使用しています。

この方法を採用した理由：
- ✅ **完全無料**（外部APIなし）
- ✅ **日本語対応**（カスタム辞書で対応）
- ✅ **オフライン動作**（サーバー内で完結）
- ✅ **セットアップ不要**（環境変数不要）
- ✅ **カスタマイズ可能**（辞書を自由に編集可能）

## 🚀 セットアップ手順

### 必要な作業: なし！

このモデレーションシステムは **追加のセットアップなし** で動作します。
- API キー不要
- 外部サービスのアカウント不要
- 環境変数の設定不要

### カスタマイズ（オプション）

不適切ワードをカスタマイズしたい場合は、[lib/moderation/badwords-ja.ts](../lib/moderation/badwords-ja.ts) を編集してください：

```typescript
export const badWordsJa = [
  '殺す', '死ね', // 暴力的な表現
  '馬鹿', 'アホ', // 侮辱的な表現
  // ここに追加したいワードを追加
];
```

## 🧪 動作確認

1. 掲示板で新しい投稿を作成してみてください
2. 以下のようなテストケースで動作を確認できます：

### 正常な投稿（承認されるべき）
```
タイトル: 育児の悩み相談
内容: 最近、子どもが夜泣きをするようになりました。何か良い対策はありますか？
```

### 不適切な投稿（拒否されるべき）
```
タイトル: テスト投稿
内容: あなたは馬鹿だ、死ね（※テスト用のみ）
```

不適切な投稿をした場合、以下のようなエラーメッセージが表示されます：
```
Content contains inappropriate material
```

## 📊 検出される内容

このモデレーションシステムは以下の要素を検出します：

### 1. **不適切ワード（Profanity）**
- 冒涜語、罵倒語
- bad-words ライブラリのデフォルト辞書（英語）
- カスタム日本語辞書に登録されたワード

### 2. **暴力的表現（Violence）**
- 「殺す」「死ね」などの暴力を示唆する表現
- 正規表現パターンマッチングで検出

### 3. **侮辱的表現（Insult）**
- 「馬鹿」「アホ」「クズ」などの侮辱的な表現
- 正規表現パターンマッチングで検出

### 検出方法
コードは [lib/openai/index.ts](../lib/openai/index.ts) と [lib/moderation/badwords-ja.ts](../lib/moderation/badwords-ja.ts) にあります。

## 🔧 トラブルシューティング

### 不適切ワードが検出されない
- [lib/moderation/badwords-ja.ts](../lib/moderation/badwords-ja.ts) に該当するワードが登録されているか確認
- 正規表現パターンが正しいか確認
- 開発サーバーを再起動してキャッシュをクリア

### 誤検知が多い
- [lib/moderation/badwords-ja.ts](../lib/moderation/badwords-ja.ts) から該当するワードを削除
- 正規表現パターンを調整して、誤検知を減らす

### カスタマイズ方法
1. [lib/moderation/badwords-ja.ts](../lib/moderation/badwords-ja.ts) を編集
2. `badWordsJa` 配列にワードを追加/削除
3. `violencePatterns` や `insultPatterns` の正規表現を調整
4. 開発サーバーを再起動

## 📚 参考リンク

- [bad-words npm パッケージ](https://www.npmjs.com/package/bad-words)
- [実装コード（モデレーション）](../lib/openai/index.ts)
- [日本語辞書](../lib/moderation/badwords-ja.ts)

## 💰 コスト

- **完全無料**（外部API不要）
- **制限なし**（サーバー内で処理）
- **スケーラブル**（外部APIの呼び出し制限なし）

## 🔒 セキュリティ

- すべての処理がサーバー内で完結
- 外部APIへのデータ送信なし
- ユーザーデータの漏洩リスクなし
- カスタマイズ可能で、プロジェクトの要件に合わせて調整可能

## 🚀 将来の拡張

より高度なモデレーションが必要な場合は、以下を検討できます：

### オプション1: Azure Content Safety
- 有料サービス（月5,000件まで無料）
- AIベースの高精度なモデレーション
- 画像モデレーションにも対応

### オプション2: カスタムMLモデル
- TensorFlow.js や ONNX Runtime を使用
- 独自のモデルをトレーニング
- より高度な文脈理解

### オプション3: OpenAI Moderation API（有料）
- 高精度だが有料
- 英語に最適化されているが日本語も対応

現在のシンプルなフィルター方式で十分な場合は、追加の実装は不要です。
