# プロフィール画像機能 ビジュアルガイド

## 機能の外観と動作

### 1. プロフィール編集ページ - 初期状態

画像が未設定の場合、イニシャルまたはデフォルトアイコンが表示されます：

```
┌────────────────────────────────┐
│   プロフィール画像              │
├────────────────────────────────┤
│                                │
│        ┌──────────┐            │
│        │          │            │
│        │    👤    │  ← イニシャルまたはアイコン
│        │          │            │
│        └──────────┘            │
│                                │
│   [画像をアップロード]          │
│                                │
│ JPEG、PNG、WebP形式、最大5MB   │
│ アップロード後、正方形に切り取れます │
└────────────────────────────────┘
```

### 2. 画像選択後 - クロップモーダル

ファイルを選択すると、クロップモーダルが表示されます：

```
┌─────────────────────────────────────────────┐
│ 画像を切り取る                    [X]       │
├─────────────────────────────────────────────┤
│                                             │
│  ┌───────────────────────────┐             │
│  │                           │             │
│  │     ╔═══════════╗         │             │
│  │     ║           ║         │             │
│  │     ║  選択範囲  ║  ← ドラッグ&リサイズ可能
│  │     ║           ║         │             │
│  │     ╚═══════════╝         │             │
│  │                           │             │
│  └───────────────────────────┘             │
│                                             │
│        [キャンセル]  [切り取りを確定]       │
└─────────────────────────────────────────────┘
```

### 3. 画像確定後 - プレビュー表示

切り取りを確定すると、プレビューが表示されます：

```
┌────────────────────────────────┐
│   プロフィール画像              │
├────────────────────────────────┤
│                                │
│        ┌──────────┐            │
│        │          │            │
│        │  [画像]  │  ← 選択した画像のプレビュー
│        │          │            │
│        └──────────┘            │
│                                │
│      [画像を変更]               │
│                                │
│ 「画像が選択されました。プロフィールを保存してください。」
└────────────────────────────────┘
```

### 4. ダッシュボード - 画像表示

保存後、ダッシュボードで画像が表示されます：

```
┌─────────────────────────────┐
│ プロフィール                 │
├─────────────────────────────┤
│                             │
│     ┌────────┐              │
│     │        │              │
│     │ [画像] │  ← 正円形で表示
│     │        │              │
│     └────────┘              │
│                             │
│   氏名: 山田 太郎            │
│   生年月日: 1990/01/01      │
│                             │
└─────────────────────────────┘
```

## UI要素の詳細

### カラーテーマ
- **親ユーザー**: グリーン系（bg-gradient-to-br from-green-400 to-green-600）
- **子ユーザー**: オレンジ系（bg-gradient-to-br from-orange-400 to-orange-600）

### ボタンスタイル
- **アップロードボタン**: 青色（bg-blue-600）、ホバーで濃い青（bg-blue-700）
- **切り取り確定ボタン**: 青色、大きめのサイズ
- **キャンセルボタン**: グレー（bg-gray-200）

### エラー表示
エラーが発生した場合、赤色の背景で警告が表示されます：

```
┌────────────────────────────────┐
│ ⚠️ ファイルサイズが大きすぎます。 │
│    5MB以下の画像を選択してください。│
└────────────────────────────────┘
```

### 成功表示
画像が選択されると、緑色の背景で成功メッセージが表示されます：

```
┌────────────────────────────────┐
│ ✓ 画像が選択されました。        │
│   プロフィールを保存してください。│
└────────────────────────────────┘
```

## 画像処理フロー

```
ユーザーが画像を選択
    ↓
バリデーション（形式・サイズチェック）
    ↓
クロップUIを表示
    ↓
ユーザーが切り取り範囲を調整
    ↓
「切り取りを確定」クリック
    ↓
クライアント側でリサイズ（500x500px）
    ↓
クライアント側で圧縮（最大500KB、JPEG 95%品質）
    ↓
プレビュー表示
    ↓
ユーザーが「プロフィールを保存」をクリック
    ↓
既存画像を削除（存在する場合）
    ↓
新しい画像をSupabase Storageにアップロード
    ↓
公開URLを取得
    ↓
profile_image_urlをデータベースに保存
    ↓
完了！ダッシュボードで画像が表示される
```

## レスポンシブデザイン

### モバイル表示
- クロップモーダルは画面いっぱいに表示
- タッチ操作でドラッグ&リサイズ可能
- ボタンは指で押しやすいサイズ

### デスクトップ表示
- クロップモーダルは中央に表示
- マウス操作で精密な調整が可能
- より大きなプレビュー画像

## アクセシビリティ

- **alt属性**: すべての画像に適切なalt属性を設定
- **キーボード操作**: Tabキーでフォーカス移動可能
- **エラーメッセージ**: 視覚的に明確で読みやすい

## パフォーマンス

- **画像の遅延読み込み**: 大きな画像は最適化されてから表示
- **キャッシュ**: 1時間のブラウザキャッシュで高速表示
- **プログレッシブ表示**: 画像が段階的に表示される

## 今後の改善点

1. **画像削除機能**: 「画像を削除」ボタンを追加
2. **複数画像対応**: 複数の画像をアップロード可能に
3. **画像回転**: 画像を回転させる機能
4. **フィルター**: 画像にフィルターを適用
5. **ドラッグ&ドロップ**: ドラッグ&ドロップで画像をアップロード
