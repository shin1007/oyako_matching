# レート制限機能 - UI/UXガイド

## 概要

このドキュメントでは、レート制限機能のユーザーインターフェースとユーザー体験について説明します。

## ユーザージャーニー

### シナリオ1: 投稿のレート制限

#### ステップ1: 通常の投稿
```
┌────────────────────────────────────────────┐
│ 新規投稿                                   │
├────────────────────────────────────────────┤
│ カテゴリ: [💬 一般相談    ▼]              │
│                                            │
│ タイトル: [初めての再会について________]   │
│                                            │
│ 内容:                                      │
│ [来週初めて子どもと会えることになりました]│
│ [どう接したらいいか不安です____________] │
│                                            │
│ ⚠️ 注意事項                                │
│ • 個人情報は投稿しないでください           │
│ • 誹謗中傷は禁止されています               │
│                                            │
│ [投稿する]  [キャンセル]                   │
└────────────────────────────────────────────┘

✅ ボタンは青色で有効
✅ すべてのフィールドが入力可能
```

#### ステップ2: 投稿成功後、すぐに2回目の投稿を試みる
```
┌────────────────────────────────────────────┐
│ 新規投稿                                   │
├────────────────────────────────────────────┤
│ ❌ 1分間の制限に達しました。               │
│    次の投稿は 45秒後 以降に可能です。      │
│    ⏱️ 45秒後に投稿可能                    │
├────────────────────────────────────────────┤
│ カテゴリ: [💬 一般相談    ▼]              │
│                                            │
│ タイトル: [2回目の投稿__________________] │
│                                            │
│ 内容:                                      │
│ [すぐに投稿したい内容です______________] │
│                                            │
│ [45秒後に投稿可能] [キャンセル]            │
└────────────────────────────────────────────┘

❌ エラーメッセージが赤い背景で表示
⏱️ カウントダウンタイマーが表示
🚫 投稿ボタンがグレーアウトして無効化
🚫 ボタンのラベルがカウントダウンに変更
```

#### ステップ3: カウントダウン中（30秒後）
```
┌────────────────────────────────────────────┐
│ 新規投稿                                   │
├────────────────────────────────────────────┤
│ ❌ 1分間の制限に達しました。               │
│    次の投稿は 15秒後 以降に可能です。      │
│    ⏱️ 15秒後に投稿可能                    │
├────────────────────────────────────────────┤
│ カテゴリ: [💬 一般相談    ▼]              │
│ ...                                        │
│ [15秒後に投稿可能] [キャンセル]            │
└────────────────────────────────────────────┘

⏱️ カウントダウンが自動的に更新される（1秒ごと）
```

#### ステップ4: カウントダウン終了後
```
┌────────────────────────────────────────────┐
│ 新規投稿                                   │
├────────────────────────────────────────────┤
│ カテゴリ: [💬 一般相談    ▼]              │
│                                            │
│ タイトル: [2回目の投稿__________________] │
│                                            │
│ 内容:                                      │
│ [すぐに投稿したい内容です______________] │
│                                            │
│ [投稿する]  [キャンセル]                   │
└────────────────────────────────────────────┘

✅ エラーメッセージが自動的に消える
✅ ボタンが再び有効になる
✅ ユーザーは再度投稿可能
```

### シナリオ2: コメントのレート制限

#### ステップ1: 通常のコメント
```
┌────────────────────────────────────────────┐
│ コメント (5)                               │
├────────────────────────────────────────────┤
│ [コメントを入力...                      ] │
│ [                                        ] │
│                                            │
│ [コメントする]                             │
└────────────────────────────────────────────┘

✅ テキストエリアが入力可能
✅ ボタンが有効
```

#### ステップ2: 30秒以内に同じ投稿への2回目のコメント
```
┌────────────────────────────────────────────┐
│ コメント (6)                               │
├────────────────────────────────────────────┤
│ ❌ 同じ投稿への連続コメントは30秒以上      │
│    間隔を空けてください。                  │
│    次のコメントは 25秒後 以降に可能です。  │
│    ⏱️ 25秒後にコメント可能                │
├────────────────────────────────────────────┤
│ [2回目のコメント__________________________]│
│ [すぐにコメントしたい___________________] │
│                                            │
│ [25秒後にコメント可能]                     │
└────────────────────────────────────────────┘

❌ エラーメッセージが表示
⏱️ カウントダウンタイマーが表示
🚫 テキストエリアが無効化（グレーアウト）
🚫 コメントボタンが無効化
🚫 カーソルが not-allowed に変更
```

#### ステップ3: カウントダウン終了後
```
┌────────────────────────────────────────────┐
│ コメント (6)                               │
├────────────────────────────────────────────┤
│ [2回目のコメント__________________________]│
│ [すぐにコメントしたい___________________] │
│                                            │
│ [コメントする]                             │
└────────────────────────────────────────────┘

✅ すべてが通常状態に戻る
✅ ユーザーはコメント可能
```

### シナリオ3: 1時間に5投稿の制限

#### 5回目の投稿後、すぐに6回目を試みる
```
┌────────────────────────────────────────────┐
│ 新規投稿                                   │
├────────────────────────────────────────────┤
│ ❌ 1時間の制限に達しました。               │
│    次の投稿は 42分30秒後 以降に可能です。  │
│    ⏱️ 42分30秒後に投稿可能                │
├────────────────────────────────────────────┤
│ ...                                        │
│ [42分30秒後に投稿可能] [キャンセル]        │
└────────────────────────────────────────────┘

⏱️ 長時間のカウントダウンは「X分Y秒後」形式で表示
```

## UI要素の詳細

### カラースキーム

#### エラーメッセージ
- **背景色**: `bg-red-50` (薄い赤)
- **文字色**: `text-red-600` (濃い赤)
- **ボーダー**: なし

#### カウントダウンタイマー
- **文字色**: `text-red-700` (より濃い赤)
- **フォントウェイト**: `font-semibold` (太字)
- **アイコン**: ⏱️ (タイマー絵文字)

#### 無効化されたボタン
- **透明度**: `opacity-50` (50%透明)
- **カーソル**: `cursor-not-allowed`
- **状態**: `disabled`

#### 無効化されたテキストエリア
- **背景色**: `bg-gray-100` (薄いグレー)
- **カーソル**: `cursor-not-allowed`
- **状態**: `disabled`

### レスポンシブデザイン

#### デスクトップ（1024px以上）
```
┌──────────────────────────────────────────────────┐
│ ❌ 1分間の制限に達しました。次の投稿は 45秒後   │
│    以降に可能です。  ⏱️ 45秒後に投稿可能       │
└──────────────────────────────────────────────────┘
```

#### タブレット（768px - 1023px）
```
┌────────────────────────────────────────┐
│ ❌ 1分間の制限に達しました。           │
│    次の投稿は 45秒後 以降に可能です。  │
│    ⏱️ 45秒後に投稿可能                │
└────────────────────────────────────────┘
```

#### モバイル（767px以下）
```
┌────────────────────────┐
│ ❌ 1分間の制限に達し   │
│    ました。            │
│    次の投稿は 45秒後   │
│    以降に可能です。    │
│    ⏱️ 45秒後に投稿可能 │
└────────────────────────┘
```

## アクセシビリティ

### キーボードナビゲーション
- ✅ すべてのボタンはTabキーでフォーカス可能
- ✅ Enterキーでフォーム送信
- ✅ Escapeキーでキャンセル可能（予定）

### スクリーンリーダー
- ✅ エラーメッセージは `role="alert"` で読み上げ（予定）
- ✅ ボタンの状態変化が伝わる
- ✅ カウントダウンは `aria-live="polite"` で更新を通知（予定）

### カラーコントラスト
- ✅ WCAG 2.1 AA基準を満たす
- ✅ 赤色の使用は適切なコントラスト比

## アニメーション

### カウントダウン更新
- **更新頻度**: 1秒ごと
- **アニメーション**: なし（シンプルなテキスト更新）
- **パフォーマンス**: `setInterval` で実装、クリーンアップ実施

### ボタン状態変化
- **トランジション**: なし（即座に変化）
- **視覚的フィードバック**: 色と不透明度の変化

### エラーメッセージ表示/非表示
- **表示**: 即座に表示
- **非表示**: カウントダウン終了時に即座に消える
- **フェード**: なし（シンプルさ優先）

## エラーメッセージのバリエーション

### 投稿制限
```
1分間の制限: "1分間の制限に達しました。次の投稿は X秒後 以降に可能です。"
1時間の制限: "1時間の制限に達しました。次の投稿は X分Y秒後 以降に可能です。"
1日の制限: "1日の制限に達しました。次の投稿は X時間Y分後 以降に可能です。"
```

### コメント制限
```
1分間の制限: "1分間の制限に達しました。次のコメントは X秒後 以降に可能です。"
1時間の制限: "1時間の制限に達しました。次のコメントは X分Y秒後 以降に可能です。"
同一投稿: "同じ投稿への連続コメントは30秒以上間隔を空けてください。次のコメントは X秒後 以降に可能です。"
```

### システムエラー
```
"現在、一時的にサービスが混み合っています。しばらくしてから再度お試しください。"
```

## ベストプラクティス

### ユーザー体験
1. **明確なフィードバック**: エラーが発生した理由を明確に伝える
2. **カウントダウン**: 次にアクション可能になる時刻を秒単位で表示
3. **視覚的なフィードバック**: ボタンとフォームの無効化で状態を明示
4. **自動回復**: カウントダウン終了後、自動的に通常状態に戻る

### パフォーマンス
1. **効率的な更新**: 1秒ごとの更新のみ（過度な再レンダリングなし）
2. **クリーンアップ**: コンポーネントのアンマウント時にタイマーをクリア
3. **最小限のDOM操作**: テキストの更新のみ

### セキュリティ
1. **サーバーサイド検証**: クライアント側の表示は補助的なもの
2. **APIレスポンス信頼**: サーバーからの `retryAfter` を使用
3. **クライアント側バイパス防止**: サーバーで最終判断

## まとめ

レート制限のUI/UXは以下の原則に基づいています：

1. **透明性**: ユーザーに制限の理由と解除時刻を明確に伝える
2. **予測可能性**: カウントダウンにより次のアクション可能時刻が分かる
3. **非侵入的**: エラーは目立つが、過度に邪魔にならない
4. **自動回復**: ユーザーが手動で何かする必要がない
5. **アクセシブル**: すべてのユーザーが情報にアクセス可能

この設計により、レート制限がユーザー体験を大きく損なうことなく、スパム防止の目的を達成できます。
